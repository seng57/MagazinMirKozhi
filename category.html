<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>–ö–∞—Ç–µ–≥–æ—Ä–∏—è ‚Äî –ú–∏—Ä –∫–æ–∂–∏ –∏ –∞–≤—Ç–æ—Ç–∫–∞–Ω–µ–π</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>

  <div class="smoke-overlay"></div>

  <header class="header">
    <div class="container">
      <h1 class="logo">–ú–∏—Ä –∫–æ–∂–∏ –∏ –∞–≤—Ç–æ—Ç–∫–∞–Ω–µ–π</h1>
      <nav>
        <ul class="nav">
          <li><a href="index.html">–ì–ª–∞–≤–Ω–∞—è</a></li>
          <li><a href="catalog.html">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</a></li>
          <li><a href="#" id="nav-category" class="active">‚Ä¶</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <section class="section fade-up catalog-section">
    <h2 id="category-title" class="section-title">–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶</h2>
    <div id="cards" class="cards"></div>
  </section>

  <!-- —Å–∫—Ä—ã—Ç–∞—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å -->
  <div id="adminToolbar"
       style="display:none; position:fixed; top:10px; right:10px; z-index:1001;">
    <button onclick="openAdminMenu()" title="–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞">‚öôÔ∏è</button>
    <button onclick="logoutAdmin()"      title="–í—ã–π—Ç–∏ –∏–∑ –∞–¥–º–∏–Ω–∫–∏">üö™</button>
  </div>

  <div id="loginForm"
       style="display:none; position:fixed; top:20%; left:50%; transform:translateX(-50%);
              background:#fff; padding:20px; box-shadow:0 4px 12px rgba(0,0,0,0.3);
              border-radius:8px; width:300px; z-index:1002;">
    <strong>–ê–¥–º–∏–Ω-–≤—Ö–æ–¥</strong>
    <input id="adminPassword" type="password" placeholder="–ü–∞—Ä–æ–ª—å"
           style="width:100%; margin:8px 0; padding:8px;"/>
    <button onclick="checkPassword()" style="width:100%; padding:8px;">–í–æ–π—Ç–∏</button>
  </div>

  <div id="adminMenu"
       style="display:none; position:fixed; top:20%; left:50%; transform:translateX(-50%);
              background:#fff; padding:20px; box-shadow:0 4px 12px rgba(0,0,0,0.3);
              border-radius:8px; width:300px; z-index:1002;">
    <h3>–ê–¥–º–∏–Ω-–º–µ–Ω—é</h3>
    <button onclick="openAdd()"        style="width:100%; margin:5px 0;">Ôºã –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</button>
    <button onclick="openEditMode()"   style="width:100%; margin:5px 0;">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
    <button onclick="openDeleteMode()" style="width:100%; margin:5px 0;">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
    <button onclick="closeAdminMenu()" style="width:100%; margin:5px 0;">–ó–∞–∫—Ä—ã—Ç—å</button>
  </div>

  <div id="adminForm"
       style="display:none; position:fixed; top:20%; left:50%; transform:translateX(-50%);
              background:#fff; padding:20px; box-shadow:0 4px 12px rgba(0,0,0,0.3);
              border-radius:8px; width:300px; z-index:1002;">
    <h3 id="formTitle">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</h3>
    <input id="prodTitle" type="text"   placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ"
           style="width:100%; margin:5px 0; padding:8px;"/>
    <input id="prodDesc"  type="text"   placeholder="–û–ø–∏—Å–∞–Ω–∏–µ"
           style="width:100%; margin:5px 0; padding:8px;"/>
    <input id="prodImg"   type="text"   placeholder="URL –∫–∞—Ä—Ç–∏–Ω–∫–∏"
           style="width:100%; margin:5px 0; padding:8px;"/>
    <input id="prodPrice" type="number" placeholder="–¶–µ–Ω–∞, ‚Ç∏"
           style="width:100%; margin:5px 0; padding:8px;"/>
    <button onclick="saveProduct()"
            style="width:100%; margin:5px 0; padding:8px;">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    <button onclick="closeAdminForm()"
            style="width:100%; margin:5px 0; padding:8px;">–û—Ç–º–µ–Ω–∞</button>
  </div>

  <button id="addBtn"
          title="–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä"
          onclick="openAdd()"
          style="display:none; position:fixed; bottom:20px; right:20px;
                 width:50px; height:50px; font-size:32px; border:none;
                 border-radius:50%; background:var(--orange); color:var(--white);
                 box-shadow:0 2px 6px rgba(0,0,0,0.2);">Ôºã</button>

  <div id="instruction"
       style="display:none; position:fixed; top:80px; left:50%; transform:translateX(-50%);
              background:rgba(0,0,0,0.75); color:#fff; padding:10px 20px;
              border-radius:5px; font-size:16px; z-index:1002;"></div>

  <footer class="footer">
    <p><a href="catalog.html" style="color:var(--orange);">‚Üê –ù–∞–∑–∞–¥ –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</a></p>
    <p>¬© 2025 –ú–∏—Ä –∫–æ–∂–∏ –∏ –∞–≤—Ç–æ—Ç–∫–∞–Ω–µ–π</p>
  </footer>

  <script>
    const ADMIN_PW_ENC = 'YWRtaW4xMjM=';
    const params = new URLSearchParams(location.search);
    const slug   = params.get('type');

    // –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è –Ω–∞–∑–≤–∞–Ω–∏—è
    const categories = JSON.parse(localStorage.getItem('categories')) || [];
    const cat = categories.find(c=>c.slug===slug);
    const categoryName = cat ? cat.title : slug;
    document.getElementById('nav-category').textContent = categoryName;

    const storageKey = 'products_' + slug;
    let products = JSON.parse(localStorage.getItem(storageKey));
    if(!products){
      products = [];
      localStorage.setItem(storageKey, JSON.stringify(products));
    }

    let adminMode=false, pendingOperation=null, editIndex=null;

    function renderProducts(){
      document.getElementById('category-title').textContent = 
        products.length
          ? `–ò–∑–¥–µ–ª–∏—è –∏–∑ ${categoryName}`
          : `–ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤ –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ¬´${categoryName}¬ª`;
      const c = document.getElementById('cards');
      c.innerHTML = '';
      products.forEach((p,i)=>{
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <img src="${p.img}" alt="${p.title}">
          <div class="card-content">
            <h3 class="card-title">${p.title}</h3>
            <p class="card-text">${p.desc}</p>
            <p class="card-price">
              <span class="price-amount">${p.price.toLocaleString()}</span>
              <span class="price-currency">‚Ç∏</span>
            </p>
          </div>`;
        if(adminMode && pendingOperation){
          card.style.cursor = 'pointer';
          card.addEventListener('click', ()=>handleCardClick(i));
        }
        c.appendChild(card);
      });
    }

    function handleCardClick(i){
      if(pendingOperation==='edit')   startEditProduct(i);
      if(pendingOperation==='delete') performDeleteProduct(i);
    }

    document.addEventListener('keydown', e=>{
      if(e.altKey && e.code==='KeyA'){
        e.preventDefault();
        document.getElementById('loginForm').style.display = 'block';
      }
    });

    function checkPassword(){
      const pw = document.getElementById('adminPassword').value.trim();
      if(pw===atob(ADMIN_PW_ENC)){
        adminMode=true;
        document.getElementById('adminToolbar').style.display = 'block';
        document.getElementById('addBtn').style.display       = 'block';
        document.getElementById('loginForm').style.display    = 'none';
        renderProducts();
      } else alert('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å');
    }

    function openAdminMenu(){   document.getElementById('adminMenu').style.display = 'block'; }
    function closeAdminMenu(){  document.getElementById('adminMenu').style.display = 'none'; }
    function logoutAdmin(){
      adminMode=false; pendingOperation=null; editIndex=null;
      document.getElementById('adminToolbar').style.display = 'none';
      document.getElementById('addBtn').style.display       = 'none';
      closeAdminMenu(); closeAdminForm(); renderProducts();
    }

    function openAdd(){
      pendingOperation=null; clearForm();
      document.getElementById('formTitle').textContent = '–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä';
      document.getElementById('adminForm').style.display = 'block';
      closeAdminMenu(); hideInstruction();
    }

    function openEditMode(){
      pendingOperation='edit'; closeAdminMenu();
      showInstruction('–ù–∞–∂–º–∏—Ç–µ –Ω–∞ —Ç–æ–≤–∞—Ä –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è');
      renderProducts();
    }

    function startEditProduct(i){
      editIndex=i;
      const p=products[i];
      document.getElementById('prodTitle').value = p.title;
      document.getElementById('prodDesc').value  = p.desc;
      document.getElementById('prodImg').value   = p.img;
      document.getElementById('prodPrice').value = p.price;
      document.getElementById('formTitle').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä';
      document.getElementById('adminForm').style.display = 'block';
      hideInstruction(); pendingOperation=null;
    }

    function openDeleteMode(){
      pendingOperation='delete'; closeAdminMenu();
      showInstruction('–ù–∞–∂–º–∏—Ç–µ –Ω–∞ —Ç–æ–≤–∞—Ä –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è');
      renderProducts();
    }

    function performDeleteProduct(i){
      if(confirm(`–£–¥–∞–ª–∏—Ç—å ¬´${products[i].title}¬ª?`)){
        products.splice(i,1);
        localStorage.setItem(storageKey, JSON.stringify(products));
        alert('–¢–æ–≤–∞—Ä —É–¥–∞–ª—ë–Ω'); renderProducts();
      }
      hideInstruction(); pendingOperation=null;
    }

    function saveProduct(){
      const t   = document.getElementById('prodTitle').value.trim();
      const d   = document.getElementById('prodDesc').value.trim();
      const img = document.getElementById('prodImg').value.trim();
      const pr  = parseInt(document.getElementById('prodPrice').value,10);
      if(!t||!img||isNaN(pr)) return alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
      const entry = { title:t, desc:d, img:img, price:pr };
      if(editIndex===null){
        products.push(entry); alert('–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω');
      } else {
        products[editIndex]=entry; alert('–¢–æ–≤–∞—Ä –∏–∑–º–µ–Ω—ë–Ω'); editIndex=null;
      }
      localStorage.setItem(storageKey, JSON.stringify(products));
      renderProducts(); closeAdminForm();
    }

    function closeAdminForm(){
      document.getElementById('adminForm').style.display='none';
      pendingOperation=null; hideInstruction();
    }
    function clearForm(){
      ['prodTitle','prodDesc','prodImg','prodPrice'].forEach(id=>
        document.getElementById(id).value=''
      );
    }
    function showInstruction(txt){
      const ins=document.getElementById('instruction');
      ins.textContent=txt; ins.style.display='block';
    }
    function hideInstruction(){
      document.getElementById('instruction').style.display='none';
    }

    document.addEventListener('DOMContentLoaded', ()=>{
      renderProducts();
      document.getElementById('nav-category').textContent = categoryName;
    });
  </script>
</body>
</html>
